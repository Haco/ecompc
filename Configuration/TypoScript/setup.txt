############################################
# Map 3rd party table fields on properties #
############################################

config.tx_extbase {
	persistence {
		enableAutomaticCacheClearing = 1
		updateReferenceIndex = 0
		classes {
			S3b0\Ecompc\Domain\Model\Content {
				mapping {
					tableName = tt_content
					columns {
						bodytext.mapOnProperty = bodytext
						tx_ecompc_packages.mapOnProperty = ecompcPackages
						tx_ecompc_configurations.mapOnProperty = ecompcConfigurations
						tx_ecompc_base_price_default.mapOnProperty = ecompcBasePriceInDefaultCurrency
						tx_ecompc_pricing.mapOnProperty = ecompcPricing
						pages.mapOnProperty = storage
						recursive.mapOnProperty = recursive
					}
				}
			}
			S3b0\Ecompc\Domain\Model\Page {
				mapping {
					tableName = pages
				}
			}
			S3b0\Ecompc\Domain\Model\Logger {
				mapping {
					tableName = tx_ecompc_domain_model_logger
					columns {
						ses_id.mapOnProperty = sesId
						tstamp.mapOnProperty = tstamp
						selected_configuration.mapOnProperty = selectedConfiguration
						configuration.mapOnProperty = configuration
						currency.mapOnProperty = currency
						price.mapOnProperty = price
						ip_address.mapOnProperty = ip
						fe_user.mapOnProperty = feUser
					}
				}
			}
			S3b0\Ecompc\Domain\Model\Option {
				mapping {
					tableName = tx_ecompc_domain_model_option
					columns {
						sorting.mapOnProperty = sorting
					}
				}
			}
		}
	}
}

###################
# Frontend Plugin #
###################
plugin.tx_ecompc {
	view {
		templateRootPath = {$plugin.tx_ecompc.view.templateRootPath}
		partialRootPath = {$plugin.tx_ecompc.view.partialRootPath}
		layoutRootPath = {$plugin.tx_ecompc.view.layoutRootPath}
	}
	persistence {
		storagePid = {$plugin.tx_ecompc.persistence.storagePid}
	}
	features {
		# uncomment the following line to enable the new Property Mapper.
		# rewrittenPropertyMapper = 1
	}
	settings {
		switchableControllerActions = Standard->index;Standard->selectPackageOptions;Standard->setOptions;Standard->resetPackage;Standard->reset;Standard->selectRegion;Standard->request
		showPriceLabels = {$plugin.tx_ecompc.constants.showPriceLabels}
		distFeUserGroup = 0
		requestForm {
			pid = {$plugin.tx_ecompc.constants.requestForm.pid}
			additionalParams = {$plugin.tx_ecompc.constants.requestForm.additionalParams}
			additionalParamsQueryString = {$plugin.tx_ecompc.constants.requestForm.additionalParamsQueryString}
			target = {$plugin.tx_ecompc.constants.requestForm.target}
		}
		log {
			ipParts = {$plugin.tx_ecompc.constants.log.ipParts}
		}
	}
}

##############################
# JavaScript and CSS section #
##############################
[globalVar = TSFE:id = {$plugin.tx_ecompc.constants.piPages}]
page.includeCSSLibs {
	ecompc = EXT:ecompc/Resources/Public/Stylesheets/app.min.css
	ecompc.import = 1
}

page.includeJSFooterlibs {
	ecompcAppJS = EXT:ecompc/Resources/Public/JavaScripts/app.min.js
	ecompcAjaxJS = EXT:ecompc/Resources/Public/JavaScripts/ajx.min.js
}
[global]
# Force not minified files to load into Development context
[applicationContext = Development]
page.includeCSSLibs {
	ecompc = EXT:ecompc/Resources/Public/Stylesheets/app.css
}
page.includeJSFooterlibs {
	ecompcAppJS = EXT:ecompc/Resources/Public/JavaScripts/app.js
	ecompcAjaxJS = EXT:ecompc/Resources/Public/JavaScripts/ajax.js
}
[global]

plugin.tx_ecompc._CSS_DEFAULT_STYLE (
	textarea.f3-form-error {
		background-color:#FF9F9F;
		border: 1px #FF0000 solid;
	}

	input.f3-form-error {
		background-color:#FF9F9F;
		border: 1px #FF0000 solid;
	}

	.tx-ecompc table {
		border-collapse:separate;
		border-spacing:10px;
	}

	.tx-ecompc table th {
		font-weight:bold;
	}

	.tx-ecompc table td {
		vertical-align:top;
	}

	.typo3-messages .message-error {
		color:red;
	}

	.typo3-messages .message-ok {
		color:green;
	}

)

EcompcDynamicConfigurationAjaxRequest = PAGE
EcompcDynamicConfigurationAjaxRequest {
	typeNum = 1407764086

	config {
		disableAllHeaderCode = 1
		xhtml_cleaning = 0
		admPanel = 0
		debug = 0
		no_cache = 1
		additionalHeaders = Content-type:application/json|Cache-Control:no-cache, must-revalidate, max-age=0|Pragma:no-cache
		linkVars = L
	}

	10 = USER
	10 {
		userFunc = TYPO3\CMS\Extbase\Core\Bootstrap->run
		vendorName = S3b0
		extensionName = Ecompc
		pluginName = configurator_dynamic
		controller = DynamicConfiguratorAjaxRequest
		switchableControllerActions {
			DynamicConfiguratorAjaxRequest {
				1 = selectPackageOptions
				2 = setOption
				3 = updatePackages
				4 = resetPackage
			}
		}
	}

	view < plugin.tx_ecompc.view
	persistence < plugin.tx_ecompc.persistence
	settings < plugin.tx_ecompc.settings
}

EcompcSkuConfigurationAjaxRequest = PAGE
EcompcSkuConfigurationAjaxRequest {
	typeNum = 1407764087

	config {
		disableAllHeaderCode = 1
		xhtml_cleaning = 0
		admPanel = 0
		debug = 0
		no_cache = 1
		additionalHeaders = Content-type:application/json|Cache-Control:no-cache, must-revalidate, max-age=0|Pragma:no-cache
		linkVars = L
	}

	10 = USER
	10 {
		userFunc = TYPO3\CMS\Extbase\Core\Bootstrap->run
		vendorName = S3b0
		extensionName = Ecompc
		pluginName = configurator_sku
		controller = SkuConfiguratorAjaxRequest
		switchableControllerActions {
			SkuConfiguratorAjaxRequest {
				1 = selectPackageOptions
				2 = setOption
				3 = updatePackages
				4 = resetPackage
			}
		}
	}

	view < plugin.tx_ecompc.view
	persistence < plugin.tx_ecompc.persistence
	settings < plugin.tx_ecompc.settings
}