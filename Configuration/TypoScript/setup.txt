############################################
# Map 3rd party table fields on properties #
############################################

config.tx_extbase {
	persistence {
		enableAutomaticCacheClearing = 1
		updateReferenceIndex = 0
		classes {
			S3b0\Ecompc\Domain\Model\Content {
				mapping {
					tableName = tt_content
					columns {
						bodytext.mapOnProperty = bodytext
						tx_ecompc_type.mapOnProperty = ecompcType
						tx_ecompc_pckg.mapOnProperty = ecompcPackages
						tx_ecompc_conf.mapOnProperty = ecompcConfigurations
						tx_ecompc_bpdc.mapOnProperty = ecompcBasePriceInDefaultCurrency
						tx_ecompc_bpfc.mapOnProperty = ecompcBasePriceInForeignCurrencies
						pages.mapOnProperty = storage
						recursive.mapOnProperty = recursive
					}
				}
			}
			S3b0\Ecompc\Domain\Model\Page {
				mapping {
					tableName = pages
				}
			}
			S3b0\Ecompc\Domain\Model\Logger {
				mapping {
					tableName = tx_ecompc_domain_model_logger
					columns {
						ses_id.mapOnProperty = sesId
						tstamp.mapOnProperty = tstamp
						selected_configuration.mapOnProperty = selectedConfiguration
						configuration.mapOnProperty = configuration
						currency.mapOnProperty = currency
						price.mapOnProperty = price
						ip_address.mapOnProperty = ip
						fe_user.mapOnProperty = feUser
					}
				}
			}
		}
	}
}

###################
# Frontend Plugin #
###################
plugin.tx_ecompc {
	view {
		templateRootPath = {$plugin.tx_ecompc.view.templateRootPath}
		partialRootPath = {$plugin.tx_ecompc.view.partialRootPath}
		layoutRootPath = {$plugin.tx_ecompc.view.layoutRootPath}
	}
	persistence {
		storagePid = {$plugin.tx_ecompc.persistence.storagePid}
	}
	features {
		# uncomment the following line to enable the new Property Mapper.
		# rewrittenPropertyMapper = 1
	}
	settings {
		switchableControllerActions = Standard->index;Standard->selectPackageOptions;Standard->setOptions;Standard->resetPackage;Standard->reset;Standard->selectRegion;Standard->request
		showPriceLabels = {$plugin.tx_ecompc.constants.showPriceLabels}
		currency {
			def {
				long = {$plugin.tx_ecompc.constants.currency.default.long}
				short = {$plugin.tx_ecompc.constants.currency.default.short}
				symbol = {$plugin.tx_ecompc.constants.currency.default.symbol}
				region = {$plugin.tx_ecompc.constants.currency.default.region}
				llRef = {$plugin.tx_ecompc.constants.currency.default.llRef}
				flagIcon = {$plugin.tx_ecompc.constants.currency.default.flagIcon}
			}
			# Activate additional currencies (key matches thos of flexform array key!)
			chf {
				long = Schweizerfranken / franc suisse / franco svizzero
				short = CHF
				symbol = SFr.
				region = Switzerland
				llRef = LLL:EXT:ecompc/Resources/Private/Language/locallang_db.xlf:currency.chf.region
				flagIcon = EXT:ecompc/Resources/Public/Images/Flags/CHE.png
				exchange = 1.21
			}
			gbp {
				long = Pound Sterling
				short = GBP
				symbol = Â£
				region = United Kingdom
				llRef = LLL:EXT:ecompc/Resources/Private/Language/locallang_db.xlf:currency.gbp.region
				flagIcon = EXT:ecompc/Resources/Public/Images/Flags/GBR.png
				prependCurrency = 1
				exchange = 0.79
			}
			usd {
				long = United States Dollar
				short = USD
				symbol = $
				region = United States
				llRef = LLL:EXT:ecompc/Resources/Private/Language/locallang_db.xlf:currency.usd.region
				flagIcon = EXT:ecompc/Resources/Public/Images/Flags/USA.png
				prependCurrency = 1
				exchange = 1.34
			}
		}
		requestForm {
			pid = {$plugin.tx_ecompc.constants.requestForm.pid}
			additionalParams = {$plugin.tx_ecompc.constants.requestForm.additionalParams}
			target = {$plugin.tx_ecompc.constants.requestForm.target}
		}
		log {
			ipParts = {$plugin.tx_ecompc.constants.log.ipParts}
		}
	}
}

##############################
# JavaScript and CSS section #
##############################
page.includeCSSLibs {
	ecompc = EXT:ecompc/Resources/Public/CSS/app.css
	ecompc.import = 1
}

page.includeJSFooterlibs {
	ecompcAppJS = EXT:ecompc/Resources/Public/JS/m.ap.js
	ecompcAjaxJS = EXT:ecompc/Resources/Public/JS/m.ax.js
}

plugin.tx_ecompc._CSS_DEFAULT_STYLE (
	textarea.f3-form-error {
		background-color:#FF9F9F;
		border: 1px #FF0000 solid;
	}

	input.f3-form-error {
		background-color:#FF9F9F;
		border: 1px #FF0000 solid;
	}

	.tx-ecompc table {
		border-collapse:separate;
		border-spacing:10px;
	}

	.tx-ecompc table th {
		font-weight:bold;
	}

	.tx-ecompc table td {
		vertical-align:top;
	}

	.typo3-messages .message-error {
		color:red;
	}

	.typo3-messages .message-ok {
		color:green;
	}

)

EcompcAjaxRequest = PAGE
EcompcAjaxRequest {
	typeNum = 1407764086

	config {
		disableAllHeaderCode = 1
		xhtml_cleaning = 0
		admPanel = 0
		debug = 0
		no_cache = 1
		additionalHeaders = Content-type:application/json|Cache-Control:no-cache, must-revalidate, max-age=0|Pragma:no-cache
	}

	10 = USER
	10 {
		userFunc = TYPO3\CMS\Extbase\Core\Bootstrap->run
		vendorName = S3b0
		extensionName = Ecompc
		pluginName = Configurator
		controller = AjaxRequest
		switchableControllerActions {
			AjaxRequest {
				1 = updatePackages
				2 = selectPackageOptions
				3 = setOption
				4 = resetPackage
			}
		}
	}

	view < plugin.tx_ecompc.view
	persistence < plugin.tx_ecompc.persistence
	settings < plugin.tx_ecompc.settings
}